    <div className="min-h-screen">
      
      {isLoading && (
        <div className="flex min-h-screen items-center justify-center bg-gray-50">
          <div className="text-center">
            <div className="mb-4 h-12 w-12 animate-spin rounded-full border-4 border-slate-200 border-t-slate-900 mx-auto" />
            <p className="text-lg font-semibold text-slate-600">Carregando dados...</p>
          </div>
        </div>
      )}


      <div className="mx-auto max-w-6xl px-4 pb-20 pt-6 sm:px-6 lg:px-8 space-y-6">
        {/* Header com Filtros Integrados */}
        <motion.div
          initial={{ opacity: 0, y: -20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.4 }}
          className="rounded-2xl bg-gradient-to-br from-blue-800 via-blue-700 to-cyan-800 p-6 text-white shadow-xl"
        >
          <div className="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6">
            {/* Título */}
            <div className="flex items-center gap-4">
              <div className="flex h-12 w-12 items-center justify-center rounded-xl bg-white/10 backdrop-blur">
                <LayoutDashboard className="h-6 w-6 text-cyan-300" />
              </div>
              <div>
                <h1 className="text-2xl font-bold text-white">Painel Operacional</h1>
                <p className="text-sm text-blue-100">Visualize e analise os dados do período</p>
              </div>
            </div>

            {/* Filtros Inline */}
            <div className="flex flex-wrap items-center gap-3">
              {/* Período Rápido */}
              <div className="flex rounded-lg bg-white/10 p-1">
                {[
                  { key: "today", label: "Hoje" },
                  { key: "7", label: "7 dias" },
                  { key: "15", label: "15 dias" },
                  { key: "30", label: "30 dias" },
                ].map(({ key, label }) => (
                  <button
                    key={key}
                    onClick={() => handleQuickRange(key as "today" | "7" | "15" | "30")}
                    className={`rounded-md px-3 py-1.5 text-xs font-medium transition-all ${
                      activeQuickRange === key
                        ? "bg-white text-blue-900 shadow"
                        : "text-blue-200 hover:text-white hover:bg-white/10"
                    }`}
                  >
                    {label}
                  </button>
                ))}
              </div>

              {/* Datas */}
              <div className="flex items-center gap-2 rounded-lg bg-white/10 px-3 py-1.5">
                <Calendar className="h-4 w-4 text-blue-300" />
                <input
                  type="date"
                  value={startDate}
                  onChange={(e) => { setStartDate(e.target.value); setActiveQuickRange(""); }}
                  className="bg-transparent text-sm text-white border-none outline-none w-28 [color-scheme:dark]"
                />
                <span className="text-blue-400">→</span>
                <input
                  type="date"
                  value={endDate}
                  onChange={(e) => { setEndDate(e.target.value); setActiveQuickRange(""); }}
                  className="bg-transparent text-sm text-white border-none outline-none w-28 [color-scheme:dark]"
                />
              </div>

              {/* Grupo */}
              <div className="flex items-center gap-2 rounded-lg bg-white/10 px-3 py-1.5">
                <Users className="h-4 w-4 text-blue-300" />
                <select
                  value={selectedGroup}
                  onChange={handleChangeGroup}
                  className="bg-transparent text-sm text-white border-none outline-none cursor-pointer"
                >
                  <option value="Todos" className="text-slate-900">Todos os Grupos</option>
                  {groups
                    .filter((group) => {
                      const allowedGroups = [
                        "suporte",
                        "data center",
                        "datacenter",
                        "delivery",
                        "registros de ligações",
                        "registros de ligacoes",
                        "qualidade",
                        "suporte interno"
                      ];
                      return allowedGroups.some(allowed => 
                        group.name.toLowerCase().includes(allowed)
                      );
                    })
                    .map((group) => (
                      <option key={group.id} value={String(group.id)} className="text-slate-900">
                        {group.name}
                      </option>
                    ))
                  }
                </select>
              </div>

              {/* Botão Buscar */}
              <button
                onClick={handleAplicarFiltros}
                disabled={isLoading}
                className="flex items-center gap-2 rounded-lg bg-cyan-500 px-4 py-2 text-sm font-semibold text-white shadow-lg shadow-cyan-500/25 hover:bg-cyan-400 transition-all disabled:opacity-50"
              >
                <Search className="h-4 w-4" />
                {isLoading ? "Buscando..." : "Buscar"}
              </button>
            </div>
          </div>

          {/* Info do período */}
          <div className="mt-4 flex items-center gap-2 text-xs text-blue-300">
            <Calendar className="h-3.5 w-3.5" />
            <span>Período: {new Date(startDate + "T12:00:00").toLocaleDateString("pt-BR", { day: "2-digit", month: "short", year: "numeric" })} até {new Date(endDate + "T12:00:00").toLocaleDateString("pt-BR", { day: "2-digit", month: "short", year: "numeric" })}</span>
            {selectedGroup !== "Todos" && (
              <>
                <span className="mx-2">•</span>
                <Users className="h-3.5 w-3.5" />
                <span>Grupo: {groups.find(g => String(g.id) === selectedGroup)?.name}</span>
              </>
            )}
          </div>
        </motion.div>

        {/* Aviso de performance */}
        <div className="flex items-center gap-2 rounded-lg bg-amber-50 border border-amber-200 px-4 py-2 text-xs text-amber-700">
          <AlertTriangle className="h-4 w-4 text-amber-500" />
          <span>Para melhor desempenho, evite buscas com períodos acima de 30 dias.</span>
        </div>

        {/* Alerta de erro genérico quando não for possível carregar dados */}
        {error && (
          <motion.div
            initial={{ opacity: 0, y: -10 }}
            animate={{ opacity: 1, y: 0 }}
            className="mt-6 rounded-lg bg-amber-50 border border-amber-200 px-4 py-3"
          >
            <p className="text-sm font-semibold text-amber-800">
              Erro ao carregar dados do Freshservice: {error}
            </p>
          </motion.div>
        )}

        {showOverviewCards && (
        <motion.section
          initial={{ opacity: 0, y: 24 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 0.1, duration: 0.5 }}
          className="space-y-4"
        >
          {/* Linha 1: 4 cards */}
          <div className="grid gap-4 sm:grid-cols-2 lg:grid-cols-4">
            {serviceCards.filter(c => c.row === 1).map(card => (
              <div
                key={card.id}
                className="group relative h-28 [perspective:1000px]"
              >
                {/* Container do flip */}
                <div className="relative h-full w-full transition-transform duration-500 [transform-style:preserve-3d] group-hover:[transform:rotateY(180deg)]">
                  {/* Frente do card */}
                  <div className="absolute inset-0 rounded-2xl border border-slate-200 bg-white p-5 shadow-sm [backface-visibility:hidden]">
                    <p className="text-xs font-medium text-slate-500 mb-3">
                      {card.label}
                    </p>
                    <div className="flex items-baseline gap-2">
                      <p className="text-2xl font-bold text-slate-900">{card.value}</p>
                      {card.status && (
                        <span className={`text-xs font-semibold ${
                          card.status === "success" ? "text-emerald-600" : 
                          card.status === "warning" ? "text-amber-600" : 
                          card.status === "danger" ? "text-red-600" : "text-slate-500"
                        }`}>
                          {card.status === "success" ? "↑" : card.status === "danger" ? "↓" : "→"}
                        </span>
                      )}
                    </div>
                  </div>
                  {/* Verso do card - informações explicativas */}
                  <div className="absolute inset-0 rounded-2xl border border-blue-200 bg-blue-50 p-4 shadow-sm [backface-visibility:hidden] [transform:rotateY(180deg)] flex flex-col justify-center">
                    <p className="text-xs font-semibold text-blue-900 mb-1">{card.label}</p>
                    <p className="text-xs text-blue-700 leading-relaxed">{card.helper}</p>
                  </div>
                </div>
              </div>
            ))}
          </div>
          
          {/* Linha 2: 4 cards */}
          <div className="grid gap-4 sm:grid-cols-2 lg:grid-cols-4">
            {serviceCards.filter(c => c.row === 2).map(card => (
              <div
                key={card.id}
                className="group relative h-28 [perspective:1000px]"
              >
                {/* Container do flip */}
                <div className="relative h-full w-full transition-transform duration-500 [transform-style:preserve-3d] group-hover:[transform:rotateY(180deg)]">
                  {/* Frente do card */}
                  <div className="absolute inset-0 rounded-2xl border border-slate-200 bg-white p-5 shadow-sm [backface-visibility:hidden]">
                    <p className="text-xs font-medium text-slate-500 mb-3">
                      {card.label}
                    </p>
                    <div className="flex items-baseline gap-2">
                      <p className="text-2xl font-bold text-slate-900">{card.value}</p>
                      {card.status && (
                        <span className={`text-xs font-semibold ${
                          card.status === "success" ? "text-emerald-600" : 
                          card.status === "warning" ? "text-amber-600" : 
                          card.status === "danger" ? "text-red-600" : "text-slate-500"
                        }`}>
                          {card.status === "success" ? "↑" : card.status === "danger" ? "↓" : "→"}
                        </span>
                      )}
                    </div>
                  </div>
                  {/* Verso do card - informações explicativas */}
                  <div className="absolute inset-0 rounded-2xl border border-blue-200 bg-blue-50 p-4 shadow-sm [backface-visibility:hidden] [transform:rotateY(180deg)] flex flex-col justify-center">
                    <p className="text-xs font-semibold text-blue-900 mb-1">{card.label}</p>
                    <p className="text-xs text-blue-700 leading-relaxed">{card.helper}</p>
                  </div>
                </div>
              </div>
            ))}
          </div>
          
          <p className="text-xs text-slate-400 mt-4">
            Passe o cursor sobre os cards para ver informações detalhadas.
          </p>
        </motion.section>
        )}


        {showKpis && (
        <section className="mt-12 space-y-6">
          <div className="flex flex-wrap items-center justify-between gap-4">
            <div>
              <p className="text-xs font-semibold uppercase tracking-[0.35em] text-slate-400">
                Principais Métricas
              </p>
              <h2 className="mt-2 text-3xl font-semibold text-slate-900">
                KPIs críticos monitorados em tempo real
              </h2>
              <p className="mt-2 max-w-3xl text-base text-slate-600">Análise detalhada dos dados do período selecionado</p>
            </div>
            <div className="flex items-center gap-2 rounded-full border border-slate-200 bg-white px-4 py-2 text-sm text-slate-500">
              <Info className="h-4 w-4 text-slate-400" />
              Fonte: Freshservice + Zenvia
            </div>
          </div>
          <div className="relative">
            {/* Grid estilo bento em telas médias/grandes */}
            <div className="hidden md:grid gap-6 md:grid-cols-2 xl:grid-cols-3">
              {computed.metrics.map(metric => (
                <KPICard key={metric.id} metric={metric} />
              ))}
            </div>

            {/* Carrossel horizontal em telas pequenas */}
            <div className="md:hidden -mx-4 overflow-x-auto pb-2">
              <div className="flex gap-4 px-1 snap-x snap-mandatory">
                {computed.metrics.map(metric => (
                  <div
                    key={metric.id}
                    className="min-w-[260px] max-w-[280px] snap-center"
                  >
                    <KPICard metric={metric} />
                  </div>
                ))}
              </div>
            </div>
          </div>
        </section>
        )}

        {showOperational && (
        <section className="mt-12 space-y-6">
          <div className="flex flex-wrap items-center justify-between gap-4">
            <div>
              <p className="text-xs font-semibold uppercase tracking-[0.35em] text-slate-400">
                Visão Operacional
              </p>
              <h2 className="mt-2 text-3xl font-semibold text-slate-900">
                Distribuição de tickets e performance por grupo
              </h2>
            </div>
            <span className="text-sm text-slate-500">Atualizado em {new Date().toLocaleString("pt-BR", { dateStyle: "long", timeStyle: "short" })}</span>
          </div>
          <div className="grid gap-6 lg:grid-cols-2">
            <ChartCard title="Suportes por Status" subtitle="Operação Freshservice">
              <DistributionBarChart data={realOperationalData?.status || computed.operational.status} />
            </ChartCard>
            <ChartCard title="Suportes por Urgência" subtitle="Fila consolidada">
              <DistributionBarChart data={realOperationalData?.urgency || computed.operational.urgency} />
            </ChartCard>
            <ChartCard title="Suportes por Prioridade" subtitle="Distribuição acumulada">
              <div className="relative h-full">
                <PriorityDonutChart data={realOperationalData?.priority || computed.operational.priority} />
                <div className="pointer-events-none absolute inset-0 flex flex-col items-center justify-center text-center">
                  <p className="text-xs font-semibold uppercase tracking-[0.3em] text-slate-400">
                    Total
                  </p>
                  <p className="text-3xl font-semibold text-slate-900">
                    {formatLargeNumber(
                      (realOperationalData?.priority || computed.operational.priority).reduce((sum, item) => sum + item.value, 0),
                    )}
                  </p>
                  <p className="text-xs uppercase tracking-[0.3em] text-slate-400">tickets</p>
                </div>
              </div>
            </ChartCard>
            <ChartCard title="Tendência de Tickets Criados" subtitle="Frequência temporal">
              <TrendLineChart data={computed.operational.trend} dataKey="tickets" />
            </ChartCard>
            <ChartCard title="SLA por Grupo" subtitle="Meta 90%">
              <SlaByGroupChart data={realOperationalData?.sla || computed.operational.sla} />
            </ChartCard>
            <ChartCard title="Volume por Grupo" subtitle="Tickets atribuídos">
              <VolumeByGroupChart data={realOperationalData?.volume || computed.operational.volume} />
            </ChartCard>
          </div>
        </section>
        )}

        {showEquipe && (
        <section className="mt-12 space-y-6">
          <div className="flex flex-wrap items-center justify-between gap-4">
            <div>
              <p className="text-xs font-semibold uppercase tracking-[0.35em] text-slate-400">
                Performance dos Analistas
              </p>
              <h2 className="mt-2 text-3xl font-semibold text-slate-900">
                Placar de líderes e detalhes por analista
              </h2>
            </div>
            <span className="inline-flex items-center gap-2 rounded-full bg-white px-4 py-2 text-sm text-slate-500 shadow-inner">
              <Info className="h-4 w-4 text-slate-400" />
              Regras iguais ao documento oficial
            </span>
          </div>
          <div className="grid gap-6 lg:grid-cols-3">
            {computed.operational.leaderboard.map((leader, index) => (
              <motion.div
                key={leader.name}
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ delay: 0.1 * index }}
                className="rounded-3xl border border-slate-100 bg-white p-6 shadow-sm"
              >
                <p className="text-xs font-semibold uppercase tracking-[0.35em] text-slate-400">
                  {index + 1}º Lugar
                </p>
                <p className="mt-2 text-2xl font-semibold text-slate-900">{leader.name}</p>
                <div className="mt-4 flex items-center gap-4 text-sm text-slate-500">
                  <div>
                    <p className="text-xs uppercase tracking-[0.3em] text-slate-400">Tickets</p>
                    <p className="text-xl font-semibold text-slate-900">
                      {leader.resolved.toLocaleString("pt-BR")}
                    </p>
                  </div>
                  <div>
                    <p className="text-xs uppercase tracking-[0.3em] text-slate-400">SLA</p>
                    <p className="text-xl font-semibold text-emerald-600">
                      {leader.sla.toFixed(0)}%
                    </p>
                  </div>
                  <div>
                    <p className="text-xs uppercase tracking-[0.3em] text-slate-400">TMA</p>
                    <p className="text-xl font-semibold text-slate-900">{leader.avgTime}</p>
                  </div>
                </div>
              </motion.div>
            ))}
          </div>
          <div className="grid gap-6 lg:grid-cols-2">
            <ChartCard title="Top 5 Analistas por Tickets Resolvidos" subtitle="Rolling 90 days">
              <TopAnalystsChart data={computed.operational.topAnalysts} />
            </ChartCard>
            <motion.div
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.5 }}
              className="rounded-3xl border border-slate-100 bg-white p-6 shadow-sm"
            >
              <div className="flex items-center justify-between">
                <div>
                  <p className="text-xs font-semibold uppercase tracking-[0.35em] text-slate-400">
                    Detalhes por Analista
                  </p>
                  <h3 className="mt-2 text-xl font-semibold text-slate-900">
                    SLAs e reaberturas
                  </h3>
                </div>
                <button className="text-sm font-semibold text-slate-500 underline-offset-4 hover:underline">
                  Exportar CSV
                </button>
              </div>
              <div className="mt-4 overflow-x-auto">
                <table className="min-w-full divide-y divide-slate-100 text-sm">
                  <thead className="text-left text-xs uppercase tracking-[0.2em] text-slate-400">
                    <tr>
                      <th className="py-2 pr-4">Analista</th>
                      <th className="py-2 pr-4">Resolvidos</th>
                      <th className="py-2 pr-4">SLA</th>
                      <th className="py-2">Reaberturas</th>
                    </tr>
                  </thead>
                  <tbody className="divide-y divide-slate-100">
                    {computed.operational.analystsTable.map(analyst => (
                      <tr key={analyst.name}>
                        <td className="py-3 pr-4 font-medium text-slate-900">{analyst.name}</td>
                        <td className="py-3 pr-4 text-slate-600">
                          {analyst.resolved.toLocaleString("pt-BR")}
                        </td>
                        <td className="py-3 pr-4 text-emerald-600">{analyst.sla}%</td>
                        <td className="py-3 text-slate-600">{analyst.reopened}</td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            </motion.div>
          </div>
        </section>
        )}


      </div>
    </div>
  );
}


